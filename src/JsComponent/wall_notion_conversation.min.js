withDocumentEvents&&(getHelperData("div.conversation_message_vote_choice_made","get_vote"),getHelperData("div.wall_message_vote_choice_made","get_vote"),_(document).on("click","div.wall_message_more, div.conversation_message_more",(function(){_("div[class*=_message_more_list]").hide(),_(this).next("div[class*=_message_more_list]").show()})),_(document.body).observerDOMChange((()=>{_("div.wall_message_container:not(.mouseEventsAdded), div.conversation_message_container:not(.mouseEventsAdded)").each((function(){this.classList.add("mouseEventsAdded"),this.addEventListener("mouseleave",(function(){_(this).find("div[class*=_message_more_list]")?.hide()}))}))})),_(document).on("click","a.wall_message_more_function.wall_message_more_edit, a.conversation_message_more_function.conversation_message_more_edit",(function(){const self=_(this);self.parent()?.show(),self.closest('div[class$=_message], div[class$="_message child"]')?.find("a[class$=_message_edit]")?.first()?.click()})),_(document).on("click","a.wall_message_more_function.wall_message_more_reply, a.conversation_message_more_function.conversation_message_more_reply",(function(){const self=_(this);self.parent()?.hide(),self.closest('div[class$=_message], div[class$="_message child"]')?.find("a[class$=_message_reply]")?.first()?.click()})),_(document).on("click","a.wall_message_more_function.wall_message_more_delete, a.conversation_message_more_function.conversation_message_more_delete",(function(){const self=_(this),message=_(this).closest('div[class$=_message], div[class$="_message child"]');self.parent()?.hide(),actionRequest({action:"conversation/wall_message_delete",obj_id:message.attr("message_id")},message)})),_(document).on("click","a.wall_message_more_function.wall_message_more_mark_read, a.conversation_message_more_function.conversation_message_more_mark_read",(function(){const self=_(this),message=self.closest("[message_id]");self.parent()?.hide(),self.remove(),actionRequest({action:"mark/mark_read",obj_id:message.attr("message_id")},message)})),_(document).on("click","a.conversation_message_more_function.conversation_message_more_need_response",(function(){const self=_(this),message=self.closest("[message_id]");self.parent()?.hide(),self.hide(),self.parent()?.find('a[class*="_message_more_has_response"]')?.show(),self.closest(".conversation_message")?.addClass("need_response"),actionRequest({action:"mark/mark_need_response",obj_id:message.attr("message_id")},message)})),_(document).on("click","a.conversation_message_more_function.conversation_message_more_has_response",(function(){const self=_(this),message=self.closest("[message_id]");self.parent()?.hide(),self.hide(),self.parent()?.find('a[class*="_message_more_need_response"]')?.show(),self.closest(".conversation_message")?.removeClass("need_response"),actionRequest({action:"mark/mark_has_response",obj_id:message.attr("message_id")},message)})),_(document).on("click","a.wall_message_edit",(function(e){e.stopImmediatePropagation();const self=_(this),id=self.attr("message_id"),content=self.closest("div.wall_message")?.find("div.wall_message_content")?.first(),ratingContent=self.closest("div.wall_message")?.find("div.wall_message_rating")?'<select name="rating" id="rating_edit"><option value="1">+1</option><option value="0">0</option><option value="-1">-1</option></select>':"",isNotion=self.closest("div.wall_message").hasClass("notion");self.text(LOCALE.cancelCapitalized).removeClass("wall_message_edit").addClass("wall_message_edit_cancel"),content.hide().insert(`<div class="wall_message_edit${isNotion?" notion":""}"><textarea name="content" message_id="${id}">${content.html().br2nl()}</textarea><div class="conversation_form_controls">${ratingContent}<button type="button" class="wall_message_save_button main">${LOCALE.saveCapitalized}</button><button type="button" class="wall_message_delete_button nonimportant">${LOCALE.deleteCapitalized}</button></div></div>`,"after"),self.closest("div.wall_message")?.find("div.wall_message_rating")?.first()&&_("select#rating_edit").val(self.closest("div.wall_message").find("div.wall_message_rating").first().text())})),_(document).on("click","a.wall_message_edit_cancel",(function(e){e.stopImmediatePropagation();const self=_(this),content=self.closest("div.wall_message")?.find("div.wall_message_content")?.first();self.text(LOCALE.editCapitalized).removeClass("wall_message_edit_cancel").addClass("wall_message_edit"),content.next("div.wall_message_edit")?.remove(),content.show()})),_(document).on("click","a.conversation_message_edit",(function(e){e.stopImmediatePropagation();const self=_(this),id=self.attr("message_id"),content=self.closest("div.conversation_message")?.find("div.conversation_message_content")?.first(),content2=content.find("div.conversation_message_content_text");self.text(LOCALE.cancelCapitalized).removeClass("conversation_message_edit").addClass("conversation_message_edit_cancel"),content.hide().insert(`<div class="conversation_message_edit"><textarea name="content" message_id="${id}">${content2.html().br2nl()}</textarea><div class="conversation_form_controls"><button type="button" class="conversation_message_save_button main">${LOCALE.saveCapitalized}</button><button type="button" class="conversation_message_delete_button nonimportant">${LOCALE.deleteCapitalized}</button></div></div>`,"after")})),_(document).on("click","a.conversation_message_edit_cancel",(function(e){e.stopImmediatePropagation();const self=_(this),content=self.closest("div.conversation_message")?.find("div.conversation_message_content")?.first();self.text(LOCALE.editCapitalized).removeClass("conversation_message_edit_cancel").addClass("conversation_message_edit"),content.next("div.conversation_message_edit")?.remove(),content.show()})),_(document).on("click","button.wall_message_save_button, button.conversation_message_save_button",(function(){const parent=_(this).closest('div[class*="_message_edit"]'),isNotion=parent?.hasClass("notion"),content=parent?.find('textarea[name="content"]'),rating=parent?.find('select[name="rating"]')?.val()||null;actionRequest({action:isNotion?"notion/notion_message_save":"conversation/message_save",obj_id:content.attr("message_id"),text:content.val(),rating:rating},parent)})),_(document).on("click","button.wall_message_delete_button, button.conversation_message_delete_button",(function(){const parent=_(this).closest('div[class*="_message_edit"]'),isNotion=parent?.hasClass("notion"),content=parent?.find('textarea[name="content"]');actionRequest({action:isNotion?"notion/notion_message_delete":"conversation/wall_message_delete",obj_id:content.attr("message_id")},parent)})),_(document).on("click","a.wall_message_reply",(function(){const self=_(this),parent=self.attr("message_id"),respondTo=self.attr("respond_to"),form=self.closest("div.wall_message").next("div.conversation_form");form.hasClass("shown")||form.show(),form.find('input[name="parent"]').val(parent),form.find('textarea[name="content"]')?.first()?.focus().val(`@${respondTo}[${self.attr("respond_to_id")}], `),showConversationForm(form)})),_(document).on("click","a.conversation_message_reply",(function(){const self=_(this),parent=self.attr("message_id"),respondTo=self.attr("respond_to");let form;if((el("form#form_application")||el("form#form_myapplication"))&&(form=el("a#change_comments_order")?self.closest("div.conversation_message_container")?.find("div.conversation_form")?.first():self.closest("div.application_conversations")?.find("div.conversation_form")?.first()),form&&form.asDomElement()||(form=self.closest("div.conversation_message_container")?.find("div.conversation_form")?.first()),form?.hasClass("shown")||form?.show(),form.find('input[name="parent"]').val(parent),form.find('textarea[name="content"]')?.first()?.focus().val(`@${respondTo}[${self.attr("respond_to_id")}], `),showConversationForm(form),el(".fraymmodal-content")){const height=el(".fraymmodal-content").scrollHeight;_(".fraymmodal-content",{noCache:!0}).scrollTop(height).destroy()}})),_arSuccess("load_wall",(function(jsonData,params,target){""==jsonData.response_text&&(jsonData.response_text="<span></span>");const newContent=_(elFromHTML(jsonData.response_text));if(newContent.find('input[type="text"][placehold], input[type="password"][placehold], textarea[placehold]')?.each((function(){const field=_(this);fraymPlaceholder(field)})),newContent.find("input.inputfile[type=file]")?.each((function(){fraymFileUploadApply(this,fileuploadOptions)})),newContent.each((function(){target.insert(this,"before")})),target.remove(),void 0!==params.search_string&&_("input#conversation_search_input").removeClass("loading"),"{main_conversation}"===params.obj_type&&el("div.actions_list_items")){const objId=_("div.actions_list_items").attr("obj_id");if(_("div[c_id].selected").removeClass("selected"),el(`div[c_id="${objId}"]`)){const selectedDialog=_(`div[c_id="${objId}"]`);selectedDialog.addClass("selected"),selectedDialog.find("div.content_preview")?.hasClass("counter")&&selectedDialog.find("div.content_preview").removeClass("unread")}}loadSbiBackground()})),_arSuccess("show_hide_notion",(function(jsonData,params,target){target.text(jsonData.response_data.text),"1"==jsonData.response_data.active?target.closest("div.wall_message_container")?.removeClass("inactive"):target.closest("div.wall_message_container")?.addClass("inactive");const prevRating=target.closest("div.wall_message")?.find("div.wall_message_rating")?.text(),header=target.closest("div.soc_part.section")?.find("h2")?.first(),curRating=header?.text().match(/\((.*?)\)/);if(curRating&&""!=prevRating){let newRating;newRating="1"==jsonData.response_data.active?parseInt(curRating[1])+parseInt(prevRating):parseInt(curRating[1])-parseInt(prevRating),newRating=newRating.toString(),newRating>0&&(newRating=`+${newRating}`),header.text(header.text().replace(/\((.*?)\)/,`(${newRating})`))}})),_arSuccess("notion_message_delete",(function(jsonData,params,target){showMessageFromJsonData(jsonData),target=target.closest("div[class$=_message]");const prevRating=target.find("div.wall_message_rating")?.text(),header=target.closest("div.block_data")?.prev("h2").find("sup"),curRating=header.text();if(curRating&&prevRating){let newRating=parseInt(curRating)-parseInt(prevRating);newRating=newRating.toString(),newRating>0&&(newRating=`+${newRating}`),header.text(newRating)}target.closest("div.wall_message_container").remove()})),_arSuccess("notion_message_save",(function(jsonData,params,target){showMessageFromJsonData(jsonData);const type="wall",content=target.find('textarea[name="content"]')?.first(),rating=target.find('select[name="rating"]')?.first()?.val(),prevRating=target.closest(`div.${type}_message_data`)?.find(`div.${type}_message_rating`)?.text(),header=target.closest("div.block_data")?.prev("h2").find("sup"),curRating=header.text();if(target.prev(`div.${type}_message_content`)?.html(content.val().nl2br()).show(),target.closest(`div.${type}_message_data`)?.find(`a.${type}_message_edit_cancel`)?.text(LOCALE.editCapitalized).removeClass(`${type}_message_edit_cancel`).addClass(`${type}_message_edit`),target.closest(`div.${type}_message_data`)?.find(`div.${type}_message_rating`)?.text(rating),curRating&&prevRating){let newRating=parseInt(curRating)+parseInt(rating)-parseInt(prevRating);newRating=newRating.toString(),newRating>0&&(newRating=`+${newRating}`),header.text(newRating)}target.remove()})),_arSuccess("message_save",(function(jsonData,params,target){showMessageFromJsonData(jsonData);const type=target.hasClass("conversation_message_edit")?"conversation":"wall",content=target.find('textarea[name="content"]');"conversation"==type?(target.prev(`div.${type}_message_content`)?.find(`div.${type}_message_content_text`)?.html(content.val().nl2br()),target.prev(`div.${type}_message_content`)?.show()):target.prev(`div.${type}_message_content`)?.html(content.val().nl2br()).show(),target.closest(`div.${type}_message_data`)?.find(`a.${type}_message_edit_cancel`)?.text(LOCALE.editCapitalized).removeClass(`${type}_message_edit_cancel`).addClass(`${type}_message_edit`),target.remove()})),_arSuccess("wall_message_delete",(function(jsonData,params,target){showMessageFromJsonData(jsonData),!target.asDomElement()||target.hasClass("wall_message")||target.hasClass("conversation_message")||(target=target.closest('div[class$=_message], div[class$="_message child"]'));const type=target.hasClass("conversation_message")?"conversation":"wall";"leave message"==jsonData.delete_type?(target.find(`div.${type}_message_content`)?.html(LOCALE.messageDeleted).show(),target.find(`a.${type}_message_edit_cancel`)?.text(LOCALE.editCapitalized).removeClass(`${type}_message_edit_cancel`).addClass(`${type}_message_edit`),target.find(`div.${type}_message_edit`)?.remove()):"delete message"==jsonData.delete_type?target.remove():"delete all"==jsonData.delete_type&&target.closest('div[class*="_message_container"]')?.remove()})));