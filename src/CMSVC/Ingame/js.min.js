let defaultCurrencyId=0,qrCanvasWidth=0,qrCanvasHeight=0,videoAllowed=!1,gCtx=null,videoOptions={facingMode:"environment"},nav=navigator,gUM=!0,showTimerDataSeconds=[],settingGeolocId=!1;if(el("#qrcode_clicker_container")){qrcodeApply();const qrcodeInput='input[name="qrcode"]';if(el(qrcodeInput)){const qrCanvas=el("#qr-canvas");qrCanvas.getContext&&qrCanvas.getContext("2d",{willReadFrequently:!0})&&nav.mediaDevices&&nav.mediaDevices.enumerateDevices&&(gCtx=qrCanvas.getContext("2d",{willReadFrequently:!0}),nav.mediaDevices.enumerateDevices().then((function(devices){_each(devices,(function(device){"videoinput"===device.kind&&(videoAllowed=!0)}))}))),_("div#qrcode_clicker_container").on("click",(function(){_("a#retry_qrcode_scanner").hide(),_("div.qrcode_result").hide(),videoAllowed?(startVideo(),_("div.qr-video-container").show(),flashlight||(flashlight=flashlightHandler,flashlight.accessFlashlight())):_(qrcodeInput).click()})),_("div.flashlight").on("click",(function(){flashlight.setFlashlightStatus(!_(this).hasClass("turnoff"))})),_(qrcodeInput).on("change",(function(){const reader=new FileReader;reader.onload=function(){qrcode.decode(reader.result)},reader.readAsDataURL(this.files[0])})),_("a#retry_qrcode_scanner").on("click",(function(){decodeQRData(_(this).attr("data"))}))}}if(el("div.kind_ingame")){if(""!==window.location.hash){const hash=window.location.hash.substring(1);if(/wmc/.test(hash)){const element=el(`a#${hash}`);ifDataLoaded("fraymTabsApply","ingameWmcScrollByHash",element,(function(){_("a#chat").parent().trigger("activate"),scrollPageTop=!1,scrollWindow(_(element).closest("div.conversation_message")?.offset().top||0)}))}}el("div.qrpg_properties_list.not_loaded")&&el("div.qrpg_keys_list.not_loaded")&&(_("div.qrpg_properties_list.not_loaded").removeClass("not_loaded"),_("div.qrpg_keys_list.not_loaded").removeClass("not_loaded"),actionRequest({action:"ingame/qrpg_get_keys_and_properties"})),_(".qrpg_code_data").on("click",(function(){_("div.qrcode_result").html("").show(),appendLoader("div.qrcode_result"),actionRequest({action:"ingame/qrpg_decode",data:_(this).attr("obj_data")},_("div.qrcode_result"))})),_("div.qrpg_property_name").on("click",(function(){const self=_(this);self.parent()?.find("div.qrpg_property_name")?.hide(),self.prev()?.show()})),_("div.qrpg_property_description.shown").on("click",(function(){const self=_(this);self.hide(),self.parent()?.find("div.qrpg_property_name")?.show()})),0!=geolocationId||settingGeolocId||(settingGeolocId=!0,geolocationId=navigator.geolocation.watchPosition((function(position){settingGeolocId=!1,_(".geoposition_info").show().removeClass("error").text(LOCALE.geoposition.active),actionRequest({action:"ingame/set_geoposition",lat:position.coords.latitude,long:position.coords.longitude,acc:position.coords.accuracy})}),(function(PositionError){1==PositionError.code?_(".geoposition_info").show().addClass("error").text(LOCALE.geoposition.needAllow):_(".geoposition_info").show().addClass("error").text(LOCALE.geoposition.error)}),{enableHighAccuracy:!0,timeout:3e5,maximumAge:0})),_('select[name="bank_currency_id"], input[name="bank_generate_qrpg_amount"], input[name="bank_generate_qrpg_name"]').on("change keydown",(function(){_("div.bank_generate_qrpg div.result button.main").show().enable(),removeLoader("div.bank_generate_qrpg div.result button.main"),_("div.bank_generate_qrpg div.result img").remove()})),_("button#bank_generate_qrpg_button").on("click",(function(){const self=_(this);actionRequest({action:"ingame/prepare_qrpg_bank_code",bank_currency_id:self.closest("div.bank_generate_qrpg")?.find('select[name="bank_currency_id"]')?.val(),amount:self.closest("div.bank_generate_qrpg")?.find('input[name="bank_generate_qrpg_amount"]')?.val(),name:self.closest("div.bank_generate_qrpg")?.find('input[name="bank_generate_qrpg_name"]')?.val()},self),_("div.bank_generate_qrpg div.result button.main").disable(),appendLoader("div.bank_generate_qrpg div.result button.main")})),defaultCurrencyId>0&&(_('select[name^="bank_currency_id"]').val(defaultCurrencyId),_('select[name^="from_bank_currency_id"]').val(defaultCurrencyId)),_("div.qrpg_hacking_start").on("click",(function(){const self=_(this);self.hasClass("text_to_access")?actionRequest({action:"ingame/qrpg_decode",qhi_id:self.closest("div.qrpg_hacking").attr("qhi_id"),text_to_access:_("input#text_to_access").val()},_("div.qrcode_result")):actionRequest({action:"ingame/qrpg_hacking_start",qha_id:self.closest("div.qrpg_hacking").attr("qha_id")},self)})),_("div.qrpg_hacking_matrix_col.selected").on("click",(function(){const self=_(this),div=self.closest("div.qrpg_hacking_active"),hackingSequence=objectToArray(JSON.parse(div.find('input[name="hacking_sequence"]').val())),matrix=div.find("div.qrpg_hacking_matrix"),qrpgHackingInputElems=div.find("div.qrpg_hacking_input div.qrpg_hacking_input_elem");self.addClass("chosen"),hackingSequence.push([self.attr("row"),self.attr("col")]),div.find('input[name="hacking_sequence"]').val(JSON.stringify(hackingSequence)),matrix.find(".selected").removeClass("selected"),"row"==matrix.attr("curType")?(matrix.attr("curType","col"),matrix.find(`[col="${self.attr("col")}"]`).not(".chosen").addClass("selected")):(matrix.attr("curType","row"),matrix.find(`[row="${self.attr("row")}"]`).not(".chosen").addClass("selected")),qrpgHackingInputElems.not(".filled").first().text(self.text()),qrpgHackingInputElems.not(".filled").first().addClass("filled"),qrpgHackingInputElems.not(".filled")?div.find("div.qrpg_hacking_input div.qrpg_hacking_input_elem.filled").length==div.find('input[name="sequences_length_sum"]').val()&&div.find(".finish").show():(window.clearInterval(window[`hacking_interval_${div.attr("qha_id")}`]),actionRequest({action:"ingame/qrpg_decode",qha_id:div.attr("qha_id"),hacking_sequence:div.find('input[name="hacking_sequence"]').val()},_("div.qrcode_result")))})),_("div.qrpg_hacking_matrix_container div.finish").on("click",(function(){const div=_(this).closest("div.qrpg_hacking_active");window.clearInterval(window[`hacking_interval_${div.attr("qha_id")}`]),actionRequest({action:"ingame/qrpg_decode",qha_id:div.attr("qha_id"),hacking_sequence:div.find('input[name="hacking_sequence"]').val()},_("div.qrcode_result"))}))}function qrcodeApply(){dataElementLoad("qrcodeApply",document,(()=>{getScript("/vendor/qrcodereader/qr_packed.min.js").then((()=>{dataLoaded.libraries.qrcodeApply=!0}))}),(function(){qrcode.callback=decodeQRData}))}function startVideo(){_("div#qrcode_clicker_container").hide(),nav.mediaDevices.getUserMedia?nav.mediaDevices.getUserMedia({video:videoOptions,audio:!1}).then((function(stream){videoSuccess(stream)})).catch((function(error){videoError(error)})):nav.getUserMedia?nav.getUserMedia({video:videoOptions,audio:!1},videoSuccess,videoError):nav.webkitGetUserMedia&&nav.webkitGetUserMedia({video:videoOptions,audio:!1},videoSuccess,videoError)}function videoSuccess(stream){const videoBlock=el("#qr-video");window.QRstream=stream,videoBlock.srcObject=stream,videoBlock.play(),gUM=!0,setTimeout(captureToCanvas,500)}function videoError(error){gUM=!1,console.log(error)}function captureToCanvas(){const qrCanvas=_("#qr-canvas"),videoBlock=el("#qr-video");if(gUM&&videoBlock){qrCanvasWidth=videoBlock.offsetWidth,qrCanvasHeight=videoBlock.offsetHeight,qrCanvas.attr("width",qrCanvasWidth).attr("height",qrCanvasHeight),gCtx.drawImage(videoBlock,0,0,qrCanvasWidth,qrCanvasHeight);try{qrcode.decode()}catch(e){setTimeout(captureToCanvas,500)}}}function decodeQRData(res){const qrcodeResultDiv=_("div.qrcode_result");qrcodeResultDiv.hide(),_("a#retry_qrcode_scanner").hide(),res instanceof Error?(qrcodeResultDiv.html(`<h1>${LOCALE.qrpgNotFoundHeader}</h1><div class="qrpg_description">${LOCALE.qrpgNotFound}</div>`),qrcodeResultDiv.show()):(stopVideo(),qrcodeResultDiv.html("").show(),appendLoader(this),actionRequest({action:"ingame/qrpg_decode",data:res},qrcodeResultDiv))}function checkQRpgTimers(){(el("div.qrpg_property_name[timer]")||el("div.qrpg_key[timer]"))&&_("div.qrpg_property_name[timer], div.qrpg_key[timer]").each((function(){const self=_(this),timerId=self.attr("id");showTimerDataSeconds[timerId]=new Date,showTimerDataSeconds[timerId].setMilliseconds(showTimerDataSeconds[timerId].getMilliseconds()+1e3*parseInt(self.attr("timer"))),window.clearInterval(window[`show_timer_data_interval_${timerId}`]),self.insert('<div class="timer"></div>',"append"),checkQRpgTimersInterval(timerId),window[`show_timer_data_interval_${timerId}`]=setInterval((function(){checkQRpgTimersInterval(timerId)}),1e3)}))}function checkQRpgTimersInterval(timerId){if(el(`div#${timerId} div.timer`)){const curDate=new Date,distance=parseInt((showTimerDataSeconds[timerId].valueOf()-curDate.valueOf())/1e3);if(distance<0)window.clearInterval(window[`show_timer_data_interval_${timerId}`]),actionRequest({action:"ingame/qrpg_get_keys_and_properties"});else{const days=Math.floor(distance/86400),hours=Math.floor(distance%86400/3600),minutes=Math.floor(distance%3600/60),seconds=Math.floor(distance%60);let showTimerDataText="";days>0&&(showTimerDataText=showTimerDataText+days+LOCALE.timer.days),hours>0&&(showTimerDataText=showTimerDataText+hours+LOCALE.timer.hours),minutes<10&&(showTimerDataText+="0"),showTimerDataText=showTimerDataText+minutes+LOCALE.timer.minutes,seconds<10&&(showTimerDataText+="0"),showTimerDataText=showTimerDataText+seconds+LOCALE.timer.seconds,_(`div#${timerId} div.timer`).text(showTimerDataText)}}else window.clearInterval(window[`show_timer_data_interval_${timerId}`])}function mp3Apply(){dataElementLoad("mp3Apply",document,(()=>{cssLoad("fraymAudioplayer","/vendor/fraym/js/audioplayer/audioplayer.min.css"),getScript("/vendor/fraym/js/audioplayer/audioplayer.min.js").then((()=>{dataLoaded.libraries.mp3Apply=!0}))}),(function(){_("div.mp3_player audio").each((function(){new FraymAudioPlayer(this,{strPlay:"",strPause:"",strVolume:""})}))}))}withDocumentEvents&&(actionRequestSupressErrorForActions.push("set_geoposition"),_arSuccess("qrpg_hacking_start",(function(jsonData,params,target){const div=target.closest("div.qrpg_hacking");div.addClass("qrpg_hacking_active"),div.html(jsonData.response_data.html),_("div.qrpg_hacking_matrix").attr("curType","row"),_("div.qrpg_hacking_matrix").find('[row="0"]').addClass("selected"),scrollWindow(_("div.qrpg_hacking_header").offset().top-65),window[`hacking_interval_${div.attr("qha_id")}`]=setInterval((function(){const timeleft=parseInt(_("div.qrpg_hacking_timer span").text());_("div.qrpg_hacking_timer span").text(timeleft-1),timeleft-1==0&&(window.clearInterval(window[`hacking_interval_${div.attr("qha_id")}`]),actionRequest({action:"ingame/qrpg_decode",qha_id:div.attr("qha_id"),hacking_sequence:div.find('input[name="hacking_sequence"]').val()},_("div.qrcode_result")))}),1e3)})),_arSuccess("qrpg_bank_pay",(function(jsonData,params,target){target=_("div.qrcode_result"),removeLoader("div.qrcode_result"),_("a#retry_qrcode_scanner").attr("data","").hide(),target.html(`<h1>${jsonData.response_data['header`]}</h1><div class="qrpg_description">${jsonData[`response_data'].description}</div>`)})),_arError("qrpg_bank_pay",(function(jsonData,params,target,error){_("div.qrcode_result"),removeLoader("div.qrcode_result"),showMessageFromJsonData(jsonData)})),_arSuccess("prepare_qrpg_bank_code",(function(jsonData,params,target){_(target).closest("div.bank_generate_qrpg")?.find("div.result")?.find("button.main")?.enable(),removeLoader(target.closest("div.bank_generate_qrpg")?.find("div.result")?.find("button.main")),target.closest("div.bank_generate_qrpg")?.find("div.result")?.insert(`<img src="/scripts/qrcode/json_string=${JSON.stringify(jsonData.response_data)}"/>`,"append"),target.closest("div.bank_generate_qrpg")?.find("div.result")?.find("button.main")?.hide()})),_arError("prepare_qrpg_bank_code",(function(jsonData,params,target,error){_(target).closest("div.bank_generate_qrpg")?.find("div.result")?.find("button.main").enable(),removeLoader(target.closest("div.bank_generate_qrpg")?.find("div.result")?.find("button.main"))})),_arSuccess("set_geoposition",(function(){})),_arError("set_geoposition",(function(){})),_arSuccess("qrpg_decode",(function(jsonData,params,target){removeLoader(target),target.html(""),void 0!==jsonData.response_data.headers?_each(jsonData.response_data.headers,(function(element,index){if("j3jkcnsmmxu82"==element){const qhi_id=jsonData.response_data.descriptions[index];-1==qhi_id?target.html(`${target.html()}<h1>${LOCALE.qrpgTextAccess.failedTitle}</h1><div class="qrpg_description">${LOCALE.qrpgTextAccess.failedDescription}</div>`):isNaN(qhi_id)?target.html(`${target.html()}<h1>${LOCALE.qrpgTextAccess.failedTitle}</h1><div class="qrpg_description">${qhi_id}</div>`):target.html(`${target.html()}<h1>${LOCALE.qrpgTextAccess.title}</h1><div class="qrpg_description qrpg_hacking qrpg_hacking_text_input" qhi_id="${qhi_id}"><div class="qrpg_hacking_description">${LOCALE.qrpgTextAccess.description}</div><div class="qrpg_hacking_text"><input type="text" id="text_to_access"></div><div class="qrpg_hacking_start text_to_access">${LOCALE.qrpgTextAccess.start}</div></div>`)}else if("xk1kljd9cjsa3"!=element)target.html(`${target.html()}<h1>${element}</h1><div class="qrpg_description">${jsonData.response_data.descriptions[index]}</div>`),el("div.mp3_player audio")&&mp3Apply();else{const qha_id=jsonData.response_data.descriptions[index];-1==qha_id?(target.html(`${target.html()}<h1>${LOCALE.qrpgHacking.failedTitle}</h1><div class="qrpg_description">${LOCALE.qrpgHacking.failedDescription}</div>`),document.getElementById("hacking_alert").play()):isNaN(qha_id)?target.html(`${target.html()}<h1>${LOCALE.qrpgHacking.failedTitle}</h1><div class="qrpg_description">${qha_id}</div>`):target.html(`${target.html()}<h1>${LOCALE.qrpgHacking.title}</h1><div class="qrpg_description qrpg_hacking" qha_id="${qha_id}"><div class="qrpg_hacking_description">${LOCALE.qrpgHacking.description}</div><div class="qrpg_hacking_start">${LOCALE.qrpgHacking.start}</div></div>`)}})):target.html(`<h1>${jsonData.response_data['header`]}</h1><div class="qrpg_description">${jsonData[`response_data'].description}</div>`),_("a#retry_qrcode_scanner").attr("data","").hide(),_("button#approve_payment").on("click",(function(){const self=_(this);actionRequest({action:"ingame/qrpg_bank_pay",account_num_to:self.closest("div.qrpg_description").find('input[name="account_num_to"]').val(),bank_currency_id:self.closest("div.qrpg_description").find('input[name="bank_currency_id"]').val(),amount:self.closest("div.qrpg_description").find('input[name="amount"]').val(),name:self.closest("div.qrpg_description").find('input[name="name"]').val()},self),self.closest("div.qrcode_result").html("").show(),appendLoader(this)})),scrollWindow(0),actionRequest({action:"ingame/qrpg_get_keys_and_properties"})})),_arError("qrpg_decode",(function(jsonData,params,target,error){removeLoader(target),_("a#retry_qrcode_scanner").attr("data",params.data).show(),target.hide()})),_arSuccess("qrpg_get_keys_and_properties",(function(jsonData,params,target){_("div.qrpg_properties_list").html(jsonData.response_data.qrpg_properties_list),_("div.qrpg_keys_list").html(jsonData.response_data.qrpg_keys_list),_("div.mp3_player audio").length&&mp3Apply(),checkQRpgTimers()})));class flashlightHandler{static track;static accessFlashlight(){if(!("mediaDevices"in window.navigator))return console.log("Media Devices not available. Use HTTPS!"),_("div.flashlight").hide(),void(flashlight=!1);window.navigator.mediaDevices.enumerateDevices().then((devices=>{const cameras=devices.filter((device=>"videoinput"===device.kind));if(0===cameras.length)return console.log("No camera found. If your device has camera available, check permissions."),_("div.flashlight").hide(),void(flashlight=!1);const camera=cameras[cameras.length-1];window.navigator.mediaDevices.getUserMedia({video:{deviceId:camera.deviceId}}).then((stream=>{this.track=stream.getVideoTracks()[0],this.track.getCapabilities().torch||(console.log("No torch available."),_("div.flashlight").hide(),flashlight=!1,this.track.stop())}))}))}static setFlashlightStatus(status){this.track&&this.track.getCapabilities().torch&&(this.track.applyConstraints({advanced:[{torch:status}]}),_("div.flashlight").toggleClass("turnoff",status))}}