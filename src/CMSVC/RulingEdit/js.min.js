let selectedNodeType="",selectedNodeId=0;function nlgraphApply(){dataElementLoad("nlgraphApply",document,(()=>{getScript("/vendor/nlgraph/nlgraph.min.js").then((()=>{dataLoaded.libraries.nlgraphApply=!0}))}),(function(){const nlgraphChartDiv=el(`#${_("div.nlgraph_chart").attr("id")}`),nlgraphChart=new NLGraph(nlgraphChartDiv,window.nlgraphNodes,window.nlgraphLinks,{width:900,height:650,zoomLens:!1,autofit:!0,forceSpeed:200,forceStatic:!0,forceCharge:-800,collisionRadius:60,lineTensionDistance:10,edgeCurve:"linear"}).render();nlgraphChart.setNodeLabel=function(nodeId,nodeType,listLabel){const listAttrVals=[],lineHeight=NLGraph.LABEL_LINE_HEIGHT;for(let i=0;i<listLabel.length;++i)listAttrVals.push(listLabel[i]);const tspanDyArray=function(baseDy,lineHeight,tspanNo){const dyArray=[];let lowerBound;lowerBound=tspanNo%2!=0?baseDy-Math.floor(tspanNo/2)*lineHeight:-(baseDy+(tspanNo/2-1)*lineHeight);for(let i=0;i<tspanNo;++i)dyArray.push(lowerBound+i*lineHeight);return dyArray}(.2,lineHeight,listLabel.length);return this.vertices.select(".label").each((function(d){if(d.id==nodeId&&d.type==nodeType){d3.select(this).text(null);const y=d3.select(this).attr("y");for(let i=0;i<listAttrVals.length;++i)d3.select(this).append("tspan").attr("x",0).attr("y",y).attr("dy",tspanDyArray[i]+"em").text(listAttrVals[i])}let bbox;try{bbox=this.getBBox()}catch(e){bbox={x:this.clientLeft,y:this.clientTop,width:this.clientWidth,height:this.clientHeight}}d.bbox=bbox,d.id==selectedNodeId&&d.type==selectedNodeType&&_(this).closest("g.node").addClass("selected_node").addClass("selected")})),this.vertices.select(".outline").attr("x",(function(d){return d.bbox.x})).attr("y",(function(d){return d.bbox.y})).attr("width",(function(d){return d.bbox.width})).attr("height",(function(d){return d.bbox.height})),this},_each(nlgraphChart.nodes,(function(value){nlgraphChart.setNodeLabel(value.id,value.type,value.attr.label)})),_each(nlgraphChart.links,(function(value){nlgraphChart.setEdgeLabel(value.source.id,value.source.type,value.target.id,value.target.type,value.etype,["label"])})),d3.select(window).on("click",(function(){nlgraphChart.unHighlight(),nlgraphChart.unSelect(),_(".highlighted").removeClass("highlighted"),_("button.ruling_chart_btn.main").attr("href","").disable()})),nlgraphChart.vertices.on("click",(function(d){_(".highlighted").removeClass("highlighted"),_(nlgraphChartDiv).addClass("highlighted");const nodes=nlgraphChart.getAssociatedNodes(d.id,d.type).map((function(d){return[d.id,d.type]})),edges=nlgraphChart.getAssociatedLinks(d.id,d.type).map((function(d){return[d.source.id,d.source.type,d.target.id,d.target.type,d.etype]})),nodesThroughEdges=[],edgesThroughEdges=[];_each(nodes,(function(value){const self=_(value);if("ifs_aggregator"==self[1]){const nodes2=nlgraphChart.getAssociatedNodes(self[0],self[1]).map((function(d){return[d.id,d.type]}));nodesThroughEdges=nodesThroughEdges.concat(nodes2);const edges2=nlgraphChart.getAssociatedLinks(self[0],self[1]).map((function(d){return[d.source.id,d.source.type,d.target.id,d.target.type,d.etype]}));edgesThroughEdges=edgesThroughEdges.concat(edges2)}})),nodes=nodes.concat(nodesThroughEdges),edges=edges.concat(edgesThroughEdges),nlgraphChart.highLight([[d.id,d.type]].concat(nodes),edges),void 0!==d.href?(_("button.ruling_chart_btn.main").attr("href",d.href).enable(),_("button.ruling_chart_btn.main.switch_to").attr("href",`/ruling_edit/ruling_${d.type}_id=${d.id}`)):_("button.ruling_chart_btn.main").attr("href","").disable()}))}))}el("div.nlgraph_chart")&&nlgraphApply(),withDocumentEvents;