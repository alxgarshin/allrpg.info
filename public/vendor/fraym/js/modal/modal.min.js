class FraymModal{constructor(element,options){if(!element)return!1;const self=_(element);if(self.hasClass("fraymmodal-window")){const overlayId=defaultFor(options.overlayId,"fraymmodal-overlay"),containerId=defaultFor(options.containerId,"fraymmodal-container"),closeButtonId=defaultFor(options.closeButtonId,"fraymmodal-close"),modalTitleClass=defaultFor(options.modalTitleClass,"fraymmodal-title"),modalContentClass=defaultFor(options.modalContentClass,"fraymmodal-content"),modalWindow=function(){const external=self.hasClass("modal-external")?"":"&modal=true";fetchData(self.attr("href")+external,{method:"GET",json:!1}).then((result=>{_(".selected").removeClass("selected");let curTabIndex=0;if(el("[tabIndex]")&&(curTabIndex=+_("[tabIndex]").last().attr("tabIndex")),_("body").addClass("noscroll"),el(`#${overlayId}`))_(`.${modalTitleClass}`).addClass("fadeToTransparent"),_(`.${modalContentClass}`).addClass("fadeToTransparent"),delay().then((()=>(el(`.${modalTitleClass}`).remove(),el(`.${modalContentClass}`).remove(),el(`#${containerId}`).insertAdjacentHTML("beforeend",result),_(`.${modalTitleClass}`).addClass("shown").addClass("fadeFromTransparent"),_(`.${modalContentClass}`).addClass("shown").addClass("fadeFromTransparent"),delay()))).then((()=>{options.onOpen(self),fixTabIndex(curTabIndex)}));else{const overlay=elNew("div",{id:overlayId}),container=elNew("div",{id:containerId});document.body.append(overlay),document.body.append(container);const closeButton=elNew("div",{id:closeButtonId});container.append(closeButton),container.insertAdjacentHTML("beforeend",result),options.onOpen(self),_(closeButton).on("click",(()=>closeModal())),_(overlay).on("click",(()=>closeModal())),_(document).on("keydown",(event=>closeModalOnEscapeKey(event))),_(overlay).addClass("shown").addClass("fadeFromTransparent"),delay().then((()=>(_(container).addClass("shown").addClass("fadeFromTransparent"),delay()))).then((()=>(_(`#${closeButtonId}`).addClass("shown").addClass("fadeFromTransparent"),_(`.${modalTitleClass}`).addClass("shown").addClass("fadeFromTransparent"),_(`.${modalContentClass}`).addClass("shown").addClass("fadeFromTransparent"),delay()))).then((()=>{options.onOpen(self),fixTabIndex(curTabIndex)}))}}))},closeModal=function(){const container=_(`#${containerId}`);container.hasClass("fraymmodal-closing")||(container.addClass("fraymmodal-closing"),_("body").removeClass("noscroll"),_(`#${closeButtonId}`).addClass("fadeToTransparent"),_(`.${modalTitleClass}`).addClass("fadeToTransparent"),_(`.${modalContentClass}`).addClass("fadeToTransparent"),delay().then((()=>(_(`#${overlayId}`).addClass("fadeToTransparent"),delay()))).then((()=>(_(`#${containerId}`).addClass("fadeToTransparent"),delay()))).then((()=>{el(`#${overlayId}`).remove(),el(`#${containerId}`).remove(),options.onClose()})))},closeModalOnEscapeKey=function(event){"Escape"===event.key&&closeModal()},fixTabIndex=function(curTabIndex){_(`#${containerId} .${modalContentClass} [tabIndex]`).each((function(){const self=_(this);self.attr("tabIndex",+self.attr("tabIndex")+curTabIndex)}))};modalWindow()}}}